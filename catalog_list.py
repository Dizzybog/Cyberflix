from datetime import datetime, timedelta

from lib import log
from lib.model.catalog_config import CatalogConfig
from lib.model.catalog_filter_type import CatalogFilterType
from lib.model.catalog_type import CatalogType


class CatalogList:
    @staticmethod
    def __get_dates(days, reverse=True):
        current_date = datetime.today()
        if reverse:
            new_date = current_date - timedelta(days=days)
        else:
            new_date = current_date + timedelta(days=days)
        return str(current_date.strftime("%Y-%m-%d")), str(new_date.strftime("%Y-%m-%d"))

    @staticmethod
    def get_catalog_configs():
        log.info("Loading catalogs...")
        premieres_current, premieres_previous = CatalogList.__get_dates(31, reverse=True)
        tmdb_discover_popular = "discover/$type?api_key=$api_key&sort_by=popularity.desc&include_adult=false&vote_average.gte=2&include_null_first_air_dates=false"
        tmdb_discover_new_movies = f"discover/$type?api_key=$api_key&sort_by=release_date.desc&release_date.lte={premieres_current}&with_release_type=1|3|2&include_adult=false&vote_average.gte=2&include_null_first_air_dates=false"
        tmdb_discover_new_series = f"discover/$type?api_key=$api_key&sort_by=first_air_date.desc&first_air_date.lte={premieres_current}&include_adult=false&vote_average.gte=2&include_null_first_air_dates=false"
        tmdb_default_lang = "&with_original_language=en|fr|es|it|pt|de|ja"

        movies_series = [CatalogType.MOVIES, CatalogType.SERIES]
        config: list[CatalogConfig] = [
            CatalogConfig(
                name_id="recommendations",
                provider_id="trakt",
                types=movies_series,
                schema="recommendations",
            ),
            CatalogConfig(
                name_id="premieres",
                provider_id="tmdb",
                types=[CatalogType.MOVIES],
                schema=f"discover/$type?api_key=$api_key&language=en-US&region=US&primary_release_date.gte={premieres_previous}&primary_release_date.lte={premieres_current}&with_release_type=1|3|2&with_original_language=en|ja",
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="premieres",
                provider_id="tmdb",
                types=[CatalogType.SERIES],
                schema=f"discover/$type?api_key=$api_key&sort_by=popularity.desc&language=en-US&region=US&first_air_date.gte={premieres_previous}&first_air_date.lte={premieres_current}&with_original_language=en|ja",
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="trending",
                provider_id="tmdb",
                types=movies_series,
                schema="trending/$type/day?api_key=$api_key",
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="awards.oscar_winners",
                provider_id="imdb",
                types=[CatalogType.ANY],
                filter_type=CatalogFilterType.YEARS,
                schema="eventId=ev0000003&sortBy=YEAR&sortOrder=DESC&locale=en-US&first=50",
                expiration_days=30,
                pages=20,
            ),
            CatalogConfig(
                name_id="awards.emmy_winners",
                provider_id="imdb",
                types=[CatalogType.ANY],
                filter_type=CatalogFilterType.YEARS,
                schema="eventId=ev0000223&sortBy=YEAR&sortOrder=DESC&locale=en-US&first=50",
                expiration_days=30,
                pages=20,
            ),
            CatalogConfig(
                name_id="awards.golden_globe_winners",
                provider_id="imdb",
                types=[CatalogType.ANY],
                filter_type=CatalogFilterType.YEARS,
                schema="eventId=ev0000292&sortBy=YEAR&sortOrder=DESC&locale=en-US&first=50",
                expiration_days=30,
                pages=20,
            ),
            CatalogConfig(
                name_id="netflix.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=nfx&country=US&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="netflix.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=nfx&country=US&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="disney_plus.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=dnp&country=US&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="disney_plus.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=dnp&country=US&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="hbo_max.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=mxx&country=US&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="hbo_max.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=mxx&country=US&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="amazon_prime.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=amp&country=US&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="amazon_prime.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=amp&country=US&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="apple_tv_plus.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=atp&country=US&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="apple_tv_plus.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=atp&country=US&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="hulu.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=hlu&country=US&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="hulu.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=hlu&country=US&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="paramount_plus.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=pmp&country=US&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="paramount_plus.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=pmp&country=US&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="peacock_premium.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=pct,pcp&country=US&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="peacock_premium.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=pct,pcp&country=US&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="starz.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=stz&country=US&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="starz.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=stz&country=US&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="sky_showtime.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=sst&country=NL&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="sky_showtime.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=sst&country=NL&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="rakuten_tv.popular",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=POPULAR&providers=wki&country=GB&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="rakuten_tv.new",
                provider_id="justwatch",
                types=movies_series,
                schema="sort=RELEASE_YEAR&providers=wki&country=GB&language=en-US&count=100",
                filter_type=CatalogFilterType.YEARS,
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="kids.popular",
                provider_id="tmdb",
                types=[CatalogType.MOVIES],
                schema=f"{tmdb_discover_popular}&with_genres=16,10751&without_genres=80|27{tmdb_default_lang}",
                hide_filters=["Animation", "Family"],
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="kids.popular",
                provider_id="tmdb",
                types=[CatalogType.SERIES],
                schema=f"{tmdb_discover_popular}&with_genres=10762{tmdb_default_lang}",
                hide_filters=["Animation", "Family"],
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="kids.new",
                provider_id="tmdb",
                types=[CatalogType.MOVIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_movies}&with_genres=16,10751&without_genres=80|27{tmdb_default_lang}",
                hide_filters=["Animation", "Family"],
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="kids.new",
                provider_id="tmdb",
                types=[CatalogType.SERIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_series}&with_genres=10762{tmdb_default_lang}",
                hide_filters=["Animation", "Family"],
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="anime.popular",
                provider_id="anilist",
                types=movies_series,
                schema="sort=POPULARITY_DESC",
                hide_filters=["Animation"],
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="anime.trending",
                provider_id="anilist",
                types=movies_series,
                schema="sort=TRENDING_DESC,POPULARITY_DESC",
                hide_filters=["Animation"],
                expiration_days=1,
                pages=20,
            ),
            CatalogConfig(
                name_id="anime.new",
                provider_id="anilist",
                types=[CatalogType.MOVIES],
                filter_type=CatalogFilterType.YEARS,
                schema="sort=START_DATE_DESC,POPULARITY_DESC&status=FINISHED",
                hide_filters=["Animation"],
                expiration_days=1,
                pages=20,
            ),
            CatalogConfig(
                name_id="anime.new",
                provider_id="anilist",
                types=[CatalogType.SERIES],
                filter_type=CatalogFilterType.YEARS,
                schema="sort=START_DATE_DESC,POPULARITY_DESC",
                hide_filters=["Animation"],
                expiration_days=1,
                pages=20,
            ),
            CatalogConfig(
                display_name="Winter Season",
                name_id="anime.season.winter",
                provider_id="anilist",
                types=movies_series,
                filter_type=CatalogFilterType.YEARS,
                schema="sort=ID_DESC&season=WINTER",
                hide_filters=["Animation"],
                pages=20,
                expiration_days=3,
            ),
            CatalogConfig(
                display_name="Spring Season",
                name_id="anime.season.spring",
                provider_id="anilist",
                types=movies_series,
                filter_type=CatalogFilterType.YEARS,
                schema="sort=ID_DESC&season=SPRING",
                hide_filters=["Animation"],
                pages=20,
                expiration_days=3,
            ),
            CatalogConfig(
                display_name="Summer Season",
                name_id="anime.season.summer",
                provider_id="anilist",
                types=movies_series,
                filter_type=CatalogFilterType.YEARS,
                schema="sort=ID_DESC&season=SUMMER",
                hide_filters=["Animation"],
                pages=20,
                expiration_days=3,
            ),
            CatalogConfig(
                display_name="Fall Season",
                name_id="anime.season.fall",
                provider_id="anilist",
                types=movies_series,
                filter_type=CatalogFilterType.YEARS,
                schema="sort=ID_DESC&season=FALL",
                hide_filters=["Animation"],
                pages=20,
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="asian.popular",
                provider_id="tmdb",
                types=movies_series,
                schema=f"{tmdb_discover_popular}&without_genres=16&with_original_language=ja|ko|th|vi|zh|id",
                hide_filters=["Animation"],
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="asian.new",
                provider_id="tmdb",
                types=[CatalogType.MOVIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_movies}&without_genres=16&with_original_language=ja|ko|th|vi|zh|id",
                hide_filters=["Animation"],
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="asian.new",
                provider_id="tmdb",
                types=[CatalogType.SERIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_series}&without_genres=16&with_original_language=ja|ko|th|vi|zh|id",
                hide_filters=["Animation"],
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="indian.popular",
                provider_id="tmdb",
                types=movies_series,
                schema=f"{tmdb_discover_popular}&without_genres=16&with_original_language=hi|bn|mr|te|ta|gu|ur|kn",
                hide_filters=["Animation"],
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="indian.new",
                provider_id="tmdb",
                types=[CatalogType.MOVIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_movies}&without_genres=16&with_original_language=hi|bn|mr|te|ta|gu|ur|kn",
                hide_filters=["Animation"],
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="indian.new",
                provider_id="tmdb",
                types=[CatalogType.SERIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_series}&without_genres=16&with_original_language=hi|bn|mr|te|ta|gu|ur|kn",
                hide_filters=["Animation"],
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="curiosity_stream.popular",
                provider_id="justwatch",
                types=[CatalogType.ANY],
                schema="sort=POPULAR&providers=cts,cta&country=GB&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="curiosity_stream.new",
                provider_id="justwatch",
                types=[CatalogType.ANY],
                filter_type=CatalogFilterType.YEARS,
                schema="sort=RELEASE_YEAR&providers=cts,cta&country=GB&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="magellan_tv.popular",
                provider_id="justwatch",
                types=[CatalogType.ANY],
                schema="sort=POPULAR&providers=mgl&country=GB&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="magellan_tv.new",
                provider_id="justwatch",
                types=[CatalogType.ANY],
                filter_type=CatalogFilterType.YEARS,
                schema="sort=RELEASE_YEAR&providers=mgl&country=GB&language=en-US&count=100",
                expiration_days=3,
                pages=20,
            ),
            CatalogConfig(
                name_id="discovery+.popular",
                provider_id="tmdb",
                types=[CatalogType.SERIES],
                schema=f"{tmdb_discover_popular}&watch_region=US&with_watch_providers=520{tmdb_default_lang}",
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="discovery+.new",
                provider_id="tmdb",
                types=[CatalogType.SERIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_series}&watch_region=US&with_watch_providers=520{tmdb_default_lang}",
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="canal+.popular",
                provider_id="tmdb",
                types=movies_series,
                schema=f"{tmdb_discover_popular}&watch_region=FR&with_watch_providers=381&with_original_language=fr",
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="canal+.new",
                provider_id="tmdb",
                types=[CatalogType.MOVIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_movies}&watch_region=FR&with_watch_providers=381&with_original_language=fr",
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="canal+.new",
                provider_id="tmdb",
                types=[CatalogType.SERIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_series}&watch_region=FR&with_watch_providers=381&with_original_language=fr",
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="videoland.popular",
                provider_id="tmdb",
                types=movies_series,
                schema=f"{tmdb_discover_popular}&watch_region=NL&with_watch_providers=72&with_original_language=nl",
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="videoland.new",
                provider_id="tmdb",
                types=[CatalogType.MOVIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_movies}&watch_region=NL&with_watch_providers=72&with_original_language=nl",
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="videoland.new",
                provider_id="tmdb",
                types=[CatalogType.SERIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_series}&watch_region=NL&with_watch_providers=72&with_original_language=nl",
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="globo_play.popular",
                provider_id="tmdb",
                types=movies_series,
                schema=f"{tmdb_discover_popular}&watch_region=BR&with_watch_providers=307&with_original_language=pt",
                expiration_days=3,
            ),
            CatalogConfig(
                name_id="globo_play.new",
                provider_id="tmdb",
                types=[CatalogType.MOVIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_movies}&watch_region=BR&with_watch_providers=307&with_original_language=pt",
                expiration_days=1,
            ),
            CatalogConfig(
                name_id="globo_play.new",
                provider_id="tmdb",
                types=[CatalogType.SERIES],
                filter_type=CatalogFilterType.YEARS,
                schema=f"{tmdb_discover_new_series}&watch_region=BR&with_watch_providers=307&with_original_language=pt",
                expiration_days=1,
            ),
        ]

        return config
